services:
  comfyui:
    build:
      context: ./services/comfyui
      dockerfile: Dockerfile
    ports:
      - "${COMFYUI_PORT:-8188}:8188"
    stop_signal: SIGKILL
    environment:
      - CLI_ARGS=""
    volumes:
      - /mnt/Tank/ai/stable-diffusion/models/loras:/comfyui/models/loras
      - /mnt/Tank/ai/stable-diffusion/models/diffusion_models:/comfyui/models/diffusion_models
      - /mnt/Tank/ai/stable-diffusion/models/text_encoders:/comfyui/models/text_encoders
      - /mnt/Tank/ai/stable-diffusion/models/vae:/comfyui/models/vae
      - /mnt/Tank/ai/stable-diffusion/models/unet:/comfyui/models/unet
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              device_ids: ["0"]
              capabilities: [compute, utility]
