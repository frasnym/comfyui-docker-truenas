services:
  comfyui:
    build:
      context: ./services/comfyui
      dockerfile: Dockerfile
    ports:
      - "${COMFYUI_PORT:-8188}:8188"
    stop_signal: SIGKILL
    environment:
      - AUTO_UPDATE_MANAGER=true # Set to false to skip updates
    volumes:
      - /mnt/Tank/ai/stable-diffusion/custom_nodes:/comfyui/custom_nodes
      - /mnt/Tank/ai/stable-diffusion/models:/comfyui/models
      - /mnt/Tank/ai/stable-diffusion/input:/comfyui/input
      - /mnt/Tank/ai/stable-diffusion/output:/comfyui/output
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              device_ids: ["0"]
              capabilities: [compute, utility]
